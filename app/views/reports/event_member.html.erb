<div class="card">
	<div class="card-header header-style">
			<h4>EVENT MEMBER SEARCH</h4>
		</div>
	<div class = "card-body">
	<%= form_tag(event_member_reports_path, method: "get") do  %>

			<div class="row justify-content-center">
        <div class="col-md-6">
          <div class="row">
            <div class="col-sm-3">
              <%= label_tag 'From Date' %>
            </div>
            <div class="col-md-9">
            <%= date_select :dates_one, :date_from1, class: "form-control", required: true %>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-sm-3">
              <%= label_tag 'To Date' %>
            </div>
            <div class="col-md-9">
              <%= date_select :dates_one, :date_to1, class: "form-control", required: true %>
            </div>
          </div>
        </div>  
      </div>
		<br>
			<div class="row justify-content-center">
	      <div class="col-md-6">
	      	<div class="row">
	      		<div class="col-sm-3">
	        		<%= label_tag 'event_name', 'Event Name' %>
	         </div>
	         <div class="col-md-9">
	        				<%= select_tag :event_name, options_for_select(@event_names, :selected => nil), { include_blank: '----- Select Event ------', class: 'form-control' , :required => true} %>
	         </div>
	       </div>
	      </div>
	      <div class="col-md-6">
	      	<div class="row">
	      		<div class="col-sm-3">
	        		<%#= label_tag 'season_name', 'Season' %><br>
	          </div>
	         <div class="col-md-7">
	        <%#= select_tag :season_name, options_for_select(season_name), { include_blank: '----- Select Season ------', class: 'form-control' , :required => true} %>
	        </div>
	      </div>
	      </div>
	      <%= hidden_field_tag 'report_type',  '205'%>
	    </div>
	    <br><br><br>

    	<div class="d-grid gap-2 mx-auto">
          <%= submit_tag "Submit", type: "submit",class:"btn mx-auto d-block", :style=>  'background-color: #7fbde3; color: white;' %>
      </div>

	<% end %>
</div>
</div><br><br><br>

<% unless @event_member_data.nil? || @event_member_data.empty? %>
<div class="card">
	<div class="card-header header-style">
			<h4>EVENT MEMBER SEARCHRESULT</h4>
		</div>
	<div class = "card-body">

			<table id="providerbillingReport" class="table table-bordered">
				<thead>
					<tr>
						<th>Name</th>
						<th>Email</th>
					</tr>
				</thead>
				<tbody>
					<% @event_member_data.each do |stu| %>
						<tr>
							<td><%= stu.student_name  %></td>
							<td><%= stu.student_email %></td>
						</tr>
					<% end %>
				</tbody>
			</table>
	<% end %>

	</div>
</div>
<br><br><br>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"> </script> 
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"> </script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"> </script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.flash.min.js"> </script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"> </script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"> </script>
<script type="text/javascript" src="https://cdn.datatables.net/searchpanes/1.2.1/js/dataTables.searchPanes.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
</div>
 <br><br> 

 <script type="text/javascript">
 	(function()

		{
		  if( window.localStorage )
		  	// debugger;
		  {
		    if( !localStorage.getItem('firstLoad') )
		    {
		      localStorage['firstLoad'] = true;
		      window.location.reload();
		    }  
		    else
		      localStorage.removeItem('firstLoad');
		  }
		}
	)();
	  // debugger;
	urlParams 					 = new URLSearchParams(window.location.search);

	var year  = urlParams.get('dates_one[date_from1(1i)]')
  var month = urlParams.get('dates_one[date_from1(2i)]')
  var date  = urlParams.get('dates_one[date_from1(3i)]')

  var year1  = urlParams.get('dates_one[date_to1(1i)]')
  var month1 = urlParams.get('dates_one[date_to1(2i)]')
  var date1  = urlParams.get('dates_one[date_to1(3i)]')

  var date_from = year + "_" + month + "_" + date
  var date_to   = year1 + "_" + month1 + "_" + date1
	var event_name  		 = urlParams.get('event_name')

	<% unless @event_member_data.nil? %>
	 var event_date = "<%= @event_member_data.first.event_date %>"
	 var event_location = "<%= @event_member_data.first.event_location %>"

	 var full_name = event_name + "," + event_location + "," + event_date
	<%end%>
 
  var fileName = "Event_" + event_name +  "_date_from_" + date_from + "_date_to_" + date_to;

$.extend($.fn.dataTable.defaults, {
  dom: 'Bfrtip'
});

  $("#providerbillingReport").DataTable({
    // searching: false,
  buttons: [
    {
    	
    extend: 'excel',
    text: 'Export',
    title: full_name,
    filename: fileName,
  }
  ]
});
  $(document).ready(function(){
    setTimeout(function(){
    $('.flash-panel').fadeOut();
    }, 2000);
  })
</script>
